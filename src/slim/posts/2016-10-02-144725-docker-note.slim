.meta-data title docker ç­†è¨˜
.meta-data datetime 2016-10-02 14:47:25
.meta-data tags docker
.meta-data category tools
.meta-data link docker-note
.meta-data file 2016-10-02-144725-docker-note
.meta-data template post
.meta-data end

h1 ä¸€èˆ¬çš„ vm èˆ‡ docker å·®åœ¨å“ªï¼Ÿ

p
  | ä¸€èˆ¬çš„ vm æœƒåœ¨ hypervisorä¸Šå†æ¶ä¸€å€‹å®Œæ•´çš„ Guest OSï¼Œæ¥è‘—æ‰æœƒå®‰è£å°æ‡‰çš„ library èˆ‡ applicationã€‚è€Œ docker æœƒæ˜¯åŸºæ–¼ Docker Engineä¸Šè·‘å¤šå€‹ containerï¼Œæ¯ä¸€å€‹ container éƒ½æ˜¯ä¸€æ”¯ç¨ç«‹çš„ user processï¼Œå…±ç”¨ Host OS çš„ Kernelã€‚

.rwd-table
  table
    tbody
      tr
        td
          | ä¸€èˆ¬çš„ vm
        td 
          | docker
      tr
        td.table-block
          table
            tbody
              tr
                td Applications 01
                td Applications 02
                td Applications 03
              tr
                td libraries 01
                td libraries 02
                td libraries 03
              tr.text-red
                td Guest OS 01
                td Guest OS 02
                td Guest OS 03
              tr.text-blue
                td colspan="3"
                  | Hyervisor (ä¾‹å¦‚ï¼šVirtualBox)
              tr
                td colspan="3"
                  | Host OS
        td.table-block
          table
            tbody
              tr
                td
                  span.text-green
                    | Container 01
                  table
                    tbody
                      tr
                        td
                          | Application 01 
                      tr
                        td
                          | Libraries 01 
                td
                  span.text-green
                    | Container 02
                  table
                    tbody
                      tr
                        td
                          | Application 02 
                      tr
                        td
                          | Libraries 02 
                td
                  span.text-green
                    | Container 03
                  table
                    tbody
                      tr
                        td
                          | Application 03 
                      tr
                        td
                          | Libraries 03 
              tr.text-blue
                td colspan="3"
                  | Docker Engine
              tr
                td colspan="3"
                  | Host OS
h2 Refs
ul
  li 
    a href="https://www.docker.com/what-docker" target="_blank"
      | WHAT IS DOCKER?
  li 
    a href="http://stackoverflow.com/questions/16047306/how-is-docker-different-from-a-normal-virtual-machine" target="_blank"
      | SO - How is Docker different from a normal virtual machine?
                
h1 åŸºæœ¬åè©

h2 Docker Client
p 
  | ä¸€å€‹å·¥å…·ç”¨ä¾†è®“ä½¿ç”¨è€…å¯ä»¥å° Docker Daemon é€æŒ‡ä»¤èˆ‡è¨­å®šã€‚
  
h2 Docker Daemon
p 
  | ä¸€å€‹è·‘åœ¨ Host Machine çš„ç¨‹å¼ï¼Œç”¨ä¾†æ“ä½œ Dockerã€‚
  
.image-center
  img src="/images/post/20161002180552965-docker-image-container.png" alt="Dockerfile, Image and Container"
  .image-text
    | Dockerfile, Image and Container
  
h2 Dockerfile
p 
  | ä¸€å€‹æª”æ¡ˆç”¨ä¾†å®šç¾©ä¸€å€‹ Docker Image è¦æ€éº¼ç”¢ç”Ÿçš„ï¼Œä¹Ÿå°±æ˜¯ Docker Image çš„åŸå§‹æª”ã€‚è£¡é¢åŒ…å«äº†å¤šå€‹æŒ‡ä»¤ä¾†æè¿° Docker Image è¦æ€éº¼è¢«å»ºç«‹ã€‚åœ¨æ•´å€‹ Docker çš„é‹ä½œä¸­åªæœƒè¢«è®€å–ç”¨ä¾†å»ºç«‹ Docker Imageï¼Œè€Œä¸æœƒè¢« Docker æ›´æ”¹ã€‚

h2 Docker Image
p 
  | ä¸€å€‹æª”æ¡ˆç”¨ä¾†å®šç¾©æ€éº¼å»ºç«‹ Docker Containerï¼Œå®ƒæ˜¯ Dockerfile ç”Ÿæˆçš„ç”¢ç‰©ï¼ŒåŒ…å«äº†è·‘ä¸€å€‹æ‡‰ç”¨ç¨‹å¼æ‰€éœ€çš„åŸ·è¡Œç’°å¢ƒèˆ‡å‡½å¼åº«ã€‚å¯ä»¥ä½¿ç”¨ 
  code
    | build
  | é€™å€‹æŒ‡ä»¤ä¾†å¾ Dockerfile å»ºç«‹ Docker Imageã€‚Docker Imageä¸€æ—¦è¢«å»ºç«‹ä¹‹å¾Œï¼Œå®ƒä¸æœƒè¢«æ›´æ”¹ï¼Œä½†å¯ä»¥ä½¿ç”¨é€™å€‹ image å»å»ºç«‹å¦ä¸€å€‹æ–°çš„ imageã€‚

h2 Docker Container
p 
  | Docker Container æ˜¯ä¸€å€‹ Docker Image çš„å¯åŸ·è¡Œå¯¦é«”(runnable instance)ï¼Œç•¶å®ƒè¢«å»ºç«‹çš„æ™‚å€™ï¼Œé™¤äº†åŒ…å«äº†å°æ‡‰çš„ Docker Image å¤–ï¼ŒDocker é‚„æœƒå»ºç«‹ä¸€å€‹å°æ‡‰çš„ read-write file system èˆ‡ä¸¦åšä¸€äº›åˆå§‹åŒ–èˆ‡ç¶²è·¯è¨­å®šã€‚ç•¶å®ƒè¢«åŸ·è¡Œæ™‚ï¼ŒDocker Container æœƒæœ‰ä¸€éš»å°æ‡‰çš„æ­£åœ¨åŸ·è¡Œä¸­çš„ processã€‚å¯ä»¥ä½¿ç”¨ 
  code
    | create
  | æŒ‡ä»¤å¾ Docker Image ä¾†å»ºç«‹ä¸€å€‹ Docker Containerã€‚ä½¿ç”¨ 
  code
    | start
  | åŸ·è¡Œ Docker Containerã€‚ä¸€å€‹æ­£åœ¨åŸ·è¡Œä¸­çš„ Docker Container ä¹Ÿæœ‰ 
  code
    | stop, restart
  | ç­‰æŒ‡ä»¤å¯ä»¥ä½¿ç”¨ã€‚

h2 Docker Register
p 
  | ç”¨ä¾†å­˜æ”¾ Docker Image çš„åœ°æ–¹ï¼Œç•¶éœ€è¦ä½¿ç”¨ Docker Image æ™‚ï¼Œå¯ä»¥ç›´æ¥å¾ Docker Register ä¸‹è¼‰è€Œä¸ç”¨é‡æ–° build imageã€‚
  
h2 Refs
ul
  li 
    a href="https://docs.docker.com/engine/understanding-docker/" target="_blank"
      | Docker Overview
  li 
    a href="http://stackoverflow.com/questions/23735149/docker-image-vs-container" target="_blank"
      | SO - Docker image vs container
  
h1 æŒ‡ä»¤

h2 docker ps
p
  | åˆ—å‡ºæ­£åœ¨åŸ·è¡Œ(running)çš„containerã€‚
ul
  li -a åˆ—å‡ºæ‰€æœ‰çš„containgerã€‚

h2 docker run [image]
p 
  | å–å¾—imageã€å»ºç«‹containerä¸¦åŸ·è¡Œã€‚
ul
  li -t åˆ†é…ä¸€å€‹è™›æ“¬çµ‚ç«¯ï¼ˆpseudo-ttyï¼‰ä¸¦ç¶å®šåˆ°containerçš„æ¨™æº–è¼¸å…¥ã€‚
  li -i ä½¿ç”¨interactionæ¨¡å¼ï¼Œè®“containerçš„æ¨™æº–è¼¸å…¥ä¿æŒé–‹å•Ÿç‹€æ…‹ï¼Œä½¿ç”¨è€…å¯ä»¥ç”±æ­¤è¼¸å…¥æŒ‡ä»¤ã€‚
  li å¦‚æœéœ€è¦ä¸€å€‹consoleé€£åˆ°containerï¼Œå‰‡ -i èˆ‡ -t å¿…é ˆè¦ä¸€èµ·ç”¨ï¼Œå¯ä»¥ç¸®å¯«æˆ -it ã€‚
  li --rm ç•¶é›¢é–‹containeræ™‚ï¼Œæ¸…é™¤æ‰€æœ‰çš„è³‡æ–™èˆ‡file systemï¼Œè¦æ³¨æ„çš„æ˜¯æœƒé€£volumnéƒ½æœƒä¸€èµ·åˆªã€‚

h3 docker search [keyword]
p 
  | æŸ¥è©¢Docker Hubä¸Šçš„imageã€‚

h3 docker images
p
  | åˆ—å‡ºæ‰€æœ‰çš„imageã€‚

h3 docker stop [container]
p 
  | åœæ­¢ç›®å‰æ­£åœ¨é‹ä½œçš„containerã€‚

h3 docker rm [container]
p 
  | ç§»é™¤containerã€‚

h3 docker inspect [container]
p 
  | å–å¾—ç›®å‰containerçš„è³‡è¨Šã€‚

h1 ä½¿ç”¨ç¯„ä¾‹

h2 ç¯„ä¾‹ï¼šä¸€å€‹å»ºç«‹phoenixç’°å¢ƒçš„Dockerfile
pre
  code.dockerfile
    | FROM elixir:1.4.2-slim

      RUN apt-get update && apt-get upgrade -y && \
          apt-get install -y curl sudo && \
          curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash - && sudo apt-get install -y nodejs

      RUN mix local.hex --force && \
          mix archive.install --force https://github.com/phoenixframework/archives/raw/master/phoenix_new.ez

      CMD ["/bin/bash"]

h2 ç¯„ä¾‹ï¼šèµ·ä¸€å€‹mysqlçš„dockerï¼Œä¸¦ä¸”è®“hostçš„mysql clientå¯ä»¥é€£åˆ°å®ƒã€‚
ul
  li å»ºç«‹ä¸€å€‹ docker-compose.yml å¦‚ä¸‹ï¼š
pre
  code.yaml
    | version: "3"
      services:
        db:
          image: mysql:5.7
          environment:
            MYSQL_ROOT_PASSWORD: "yit0v5911gcfckbd1guk2ctumrdcy8nb"
          ports:
            - "7364:3306"
ul
  li
    | åŸ·è¡Œ
    code
      | docker-compose up
  li 
    | é€£ç·š
    code
      | mysql -h 127.0.0.1 -P 7364 -u root -p
      

h2 ç¯„ä¾‹ï¼šèµ·ä¸€å€‹ debian server èˆ‡ mysql server çš„dockerï¼Œä¸¦ä¸”è®“ debian server å¯ä»¥é€£åˆ° mysql serverã€‚
ul
  li å»ºç«‹ä¸€å€‹ docker-compose.yml å¦‚ä¸‹ï¼š
pre
  code.yaml
    | version: "3"
      services:
        db:
          image: mysql:5.7
          environment:
            MYSQL_ROOT_PASSWORD: "lvkn9ey1bcty55ghmyedncr79ycdcvgo"
        server:
          image: debian:jessie
          stdin_open: true
          tty: true
ul
  li
    | åŸ·è¡Œ
    code
      | docker-compose up
  li 
    | åŸ·è¡Œ
    code
      | docker attach [debian_server_container_name]
    | é€²å…¥ server çš„ containerã€‚å…¶ä¸­debian_server_container_nameå³æ˜¯å°æ‡‰debian containerçš„nameã€‚ç•¶ä½ åŸ·è¡Œdocker-compose upçš„æ™‚å€™ï¼Œlogå°±æœƒé¡¯ç¤ºcontainerçš„åç¨±ã€‚
  li 
    | å®‰è£ mysql-client
    code
      | root@210978bba57f:/# apt-get update && apt-get upgrade && apt-get install mysql-client
  li 
    | é€£ç·šè‡³mysql
    code
      | root@210978bba57f:/# mysql -hdb -P3306 -uroot -p
    | ã€‚å…¶ä¸­æˆ‘å€‘æŠŠhostè¨­æˆdbï¼Œé€™æ˜¯å› ç‚ºdocker composeçš„åŠŸèƒ½ï¼Œå®ƒå°‡åŒä¸€å€‹composeä¸‹çš„serviceéƒ½æ”¾åœ¨åŒä¸€å€‹private networkä¸­ï¼Œè€Œåœ¨compose.ymlè£¡è¨­å®šçš„serviceåç¨±å°±å¯ä»¥ç”¨ä¾†ä»£è¡¨serverå°æ‡‰çš„ipä½å€ã€‚
    
h2 Refs
ul
  li 
    a href="https://docs.docker.com/compose/networking/" target="_blank"
      | Docker Doc - Networking in Compose

h1 Resources

h2 Links
ul
  li 
    a href="https://www.gitbook.com/book/philipzheng/docker_practice/details" target="_blank"
      | ã€ŠDocker â€”â€” å¾å…¥é–€åˆ°å¯¦è¸Â­ã€‹æ­£é«”ä¸­æ–‡ç‰ˆ
  li 
    a href="http://www.slideshare.net/trunk-studio/docker-65378344" target="_blank"
      | å‰µç§‘ å¾é›¶é–‹å§‹èªè­˜ Docker
  li 
    a href="http://bingohuang.com/simplify-docker-image-1/" target="_blank"
      | 7 æ­¥ç²¾ç®€ Docker é•œåƒï¼ˆä¸Šï¼‰
  li 
    a href="http://bingohuang.com/simplify-docker-image-2/" target="_blank"
      | 7 æ­¥ç²¾ç®€ Docker é•œåƒï¼ˆä¸‹ï¼‰
  li 
    a href="http://blog.runnable.com/post/145895165446/9-common-dockerfile-mistakes" target="_blank"
      | 9 Common Dockerfile Mistakes
  li 
    a href="http://container-solutions.com/understanding-volumes-docker/" target="_blank"
      | Understanding Volumes in Docker
  li 
    a href="http://dockone.io/" target="_blank"
      | DockOne.ioï¼Œæœ€ä¸“ä¸šçš„Dockeräº¤æµå¹³å°
  li 
    a href="https://thehftguy.com/2016/11/01/docker-in-production-an-history-of-failure/" target="_blank"
      | Docker in Production: A History of Failure

h2 Books
ul
  li 
    a href="https://www.openshift.com/promotions/docker-security.html" target="_blank"
      | Docker Security: Using Containers Safely in Production - Adrian Mouat
